Pront: Actúa como un desarrollador Senior en Java. Implementa la clase Order y todos los metodos especificados en el siguiente archivo, ademas el proyecto cuenta con este prototipado puedes revisarlo y generar la implementacion completa

¡Entendido! He revisado los archivos que has subido. Veo que tienes una estructura de proyecto Maven clara y que Item es una interfaz, no una clase concreta, lo cual es un detalle importante para la implementación. También veo que Product usa un id (long) para identificarse.
Como desarrollador Senior, aquí tienes la implementación robusta y completa. Debes crear/modificar dos archivos principalmente: IncorrectItemException.java (que no estaba en tu lista pero es obligatoria según la especificación) y Order.java.
1. Crear la Excepción
Primero, necesitas crear este archivo en el paquete correcto, ya que el método addItem debe lanzar esta excepción si los datos son incorrectos.
Archivo: src/main/java/es/upm/grise/profundizacion/order/IncorrectItemException.java

Java


package es.upm.grise.profundizacion.order;

public class IncorrectItemException extends Exception {
    
    // Es buena práctica añadir un serialVersionUID en excepciones serializables
    private static final long serialVersionUID = 1L;

    public IncorrectItemException(String message) {
        super(message);
    }
}


2. Implementación de Order.java
Aquí tienes la implementación lógica. He respetado el prototipo que subiste, pero he tenido que añadir throws IncorrectItemException a la firma del método addItem. Esto es obligatorio en Java si la excepción es verificada (checked), o de lo contrario el código no compilaría.

Nota sobre la lógica:
Como Product no tiene el método equals implementado en el archivo que me pasaste, compararé los productos usando su id (disponible mediante getId()).


Como Item es una interfaz, usaremos sus métodos get y set para manipular los datos.
Archivo: src/main/java/es/upm/grise/profundizacion/order/Order.java

Java


package es.upm.grise.profundizacion.order;

import java.util.ArrayList;
import java.util.Collection;
import java.util.Iterator;

public class Order {

    // La especificación pide una lista de items
    private Collection<Item> items;

    /*
     * Constructor
     */
    public Order() {
        // "La lista de items deberá estar vacía, pero no nula." [cite: 13]
        this.items = new ArrayList<>();
    }

    /*
     * Method to code / test
     */
    public void addItem(Item item) throws IncorrectItemException {
        
        // 1. Validar el precio
        // "El price del item deberá ser mayor o igual a cero." [cite: 18]
        if (item.getPrice() < 0) {
            throw new IncorrectItemException("El precio del artículo no puede ser negativo.");
        }

        // 2. Validar la cantidad
        // "La quantity del item será mayor que cero." [cite: 20]
        if (item.getQuantity() <= 0) {
            throw new IncorrectItemException("La cantidad del artículo debe ser mayor que cero.");
        }

        // 3. Lógica de inserción o actualización
        boolean itemMerged = false;

        // Recorremos la colección existente
        for (Item existingItem : items) {
            
            // Verificamos si es el mismo producto comparando sus IDs
            // (Asumimos igualdad por ID ya que Product.java no tiene equals/hashCode)
            if (areProductsEqual(existingItem.getProduct(), item.getProduct())) {
                
                // Si el producto existe y el precio es el MISMO
                if (existingItem.getPrice() == item.getPrice()) {
                    // "Si el product ya existe... se incrementa la quantity" 
                    int newQuantity = existingItem.getQuantity() + item.getQuantity();
                    existingItem.setQuantity(newQuantity);
                    itemMerged = true;
                    break; // Terminamos porque ya actualizamos
                }
                // Si el precio varía, no hacemos nada aquí, dejaremos que se añada como nuevo item abajo [cite: 23]
            }
        }

        // Si no se fusionó con uno existente (porque no existía o el precio era diferente)
        if (!itemMerged) {
            // "Este método añade un item a la order" [cite: 16]
            items.add(item);
        }
    }
    
    /*
     * Setters/getters
     */
    public Collection<Item> getItems() {
        return this.items;
    }

    /**
     * Método auxiliar para comparar productos de forma segura
     */
    private boolean areProductsEqual(Product p1, Product p2) {
        if (p1 == null || p2 == null) return false;
        // Comparamos por ID según la estructura de Product.java proporcionada
        return p1.getId() == p2.getId();
    }
}


Pasos para integrarlo en tu proyecto:
Crea el archivo IncorrectItemException.java en la misma carpeta que Order.java.
Reemplaza el contenido de Order.java con el código de arriba.
No necesitas modificar Product.java ni Item.java (la lógica se encarga de manejarlos tal cual son).
Realiza el commit de estos cambios siguiendo el Paso 6 de tus instrucciones (git add, git commit -m "Implementación de lógica Order").
Guarda esta conversación en conv_programacion.txt.
¿Quieres que proceda ahora a generar el código de los tests unitarios (OrderTest.java) para el Paso 7?
